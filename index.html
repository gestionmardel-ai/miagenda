<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusAgenda | Mi Agenda Personal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .completed { text-decoration: line-through; opacity: 0.5; }
        .transition-all { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <div id="login-screen" class="flex items-center justify-center min-h-screen px-4">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-gray-100">
            <div class="text-center mb-8">
                <div class="bg-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 rotate-3 shadow-lg">
                    <i class="fas fa-check-double text-white text-2xl"></i>
                </div>
                <h2 id="auth-title" class="text-3xl font-bold text-gray-800">Bienvenido</h2>
                <p id="auth-subtitle" class="text-gray-500">Gestiona tus prioridades hoy</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1 ml-1">Usuario</label>
                    <input type="text" id="username" placeholder="Ej: juan_perez" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-400 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1 ml-1">Contrase√±a</label>
                    <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-400 outline-none transition-all">
                </div>
                
                <div class="flex flex-col gap-3 pt-2">
                    <button onclick="handleAuth('login')" class="w-full bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-md active:scale-95">
                        Iniciar Sesi√≥n
                    </button>
                    <div class="relative py-2">
                        <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200"></div></div>
                        <div class="relative flex justify-center text-xs uppercase"><span class="bg-white px-2 text-gray-400">¬øEres nuevo?</span></div>
                    </div>
                    <button onclick="handleAuth('register')" class="w-full bg-emerald-50 text-emerald-600 p-3 rounded-xl font-bold hover:bg-emerald-100 transition-all border border-emerald-200">
                        Crear Cuenta Gratis
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="agenda-screen" class="hidden">
        <nav class="bg-white border-b p-4 sticky top-0 z-10 shadow-sm">
            <div class="container mx-auto flex justify-between items-center px-2">
                <div class="flex items-center gap-2">
                    <span class="bg-blue-600 text-white p-1.5 rounded-lg"><i class="fas fa-calendar-day"></i></span>
                    <h1 class="text-xl font-black text-gray-800 tracking-tight">FocusAgenda</h1>
                </div>
                <div class="flex items-center gap-4">
                    <span id="user-display" class="hidden sm:inline text-gray-600 font-semibold bg-gray-100 px-3 py-1 rounded-full text-sm"></span>
                    <button onclick="logout()" class="text-gray-400 hover:text-red-500 transition-colors">
                        <i class="fas fa-power-off text-lg"></i>
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto p-4 max-w-5xl">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-8 mt-4">
                <div class="flex items-center gap-2 mb-4 border-b pb-2">
                    <i class="fas fa-plus-circle text-blue-500"></i>
                    <h3 id="form-title" class="text-lg font-bold text-gray-800">Nueva Tarea</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Detalle de la prioridad</label>
                        <input type="text" id="task-detail" placeholder="Ej: Terminar informe mensual" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Fecha L√≠mite</label>
                        <input type="date" id="task-deadline" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Prioridad</label>
                        <select id="task-priority" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none bg-white">
                            <option value="Baja">Baja</option>
                            <option value="Media" selected>Media</option>
                            <option value="Alta">Alta üî•</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4 flex flex-wrap gap-2">
                    <button onclick="saveTask()" id="btn-save" class="bg-blue-600 text-white px-8 py-2.5 rounded-lg font-bold hover:bg-blue-700 transition shadow-md active:scale-95">
                        Guardar Tarea
                    </button>
                    <button id="btn-cancel" onclick="clearForm()" class="hidden bg-gray-100 text-gray-500 px-8 py-2.5 rounded-lg font-bold hover:bg-gray-200 transition">
                        Cancelar
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="p-4 text-xs font-bold text-gray-400 uppercase w-16 text-center">OK</th>
                                <th class="p-4 text-xs font-bold text-gray-400 uppercase">Tarea / Prioridad</th>
                                <th class="p-4 text-xs font-bold text-gray-400 uppercase hidden md:table-cell">Registrada</th>
                                <th class="p-4 text-xs font-bold text-gray-400 uppercase">Vencimiento</th>
                                <th class="p-4 text-xs font-bold text-gray-400 uppercase text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="task-list" class="divide-y divide-gray-100">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let tasks = [];
        let editIndex = null;

        // --- SISTEMA DE AUTENTICACI√ìN ---
        function handleAuth(type) {
            const user = document.getElementById('username').value.trim().toLowerCase();
            const pass = document.getElementById('password').value.trim();

            if (!user || !pass) {
                alert("‚ö†Ô∏è Por favor completa los campos.");
                return;
            }

            let users = JSON.parse(localStorage.getItem('agenda_app_users')) || {};

            if (type === 'register') {
                if (users[user]) {
                    alert("‚ùå Este usuario ya existe.");
                } else {
                    users[user] = pass;
                    localStorage.setItem('agenda_app_users', JSON.stringify(users));
                    alert("‚úÖ ¬°Registro exitoso! Ya puedes entrar.");
                }
            } else {
                if (users[user] && users[user] === pass) {
                    currentUser = user;
                    document.getElementById('user-display').innerText = `Usuario: ${user}`;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('agenda-screen').classList.remove('hidden');
                    loadTasks();
                } else {
                    alert("‚ùå Credenciales incorrectas.");
                }
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('agenda-screen').classList.add('hidden');
            document.getElementById('password').value = '';
        }

        // --- L√ìGICA DE LA AGENDA ---
        function loadTasks() {
            const stored = localStorage.getItem(`tasks_${currentUser}`);
            tasks = stored ? JSON.parse(stored) : [];
            renderTasks();
        }

        function saveTask() {
            const detail = document.getElementById('task-detail').value.trim();
            const deadline = document.getElementById('task-deadline').value;
            const priority = document.getElementById('task-priority').value;

            if (!detail) return alert("Escribe un detalle para la tarea");

            const taskData = {
                detail,
                deadline: deadline || 'Sin fecha',
                priority,
                created: new Date().toLocaleDateString(),
                completed: false
            };

            if (editIndex !== null) {
                tasks[editIndex] = { ...tasks[editIndex], detail, deadline, priority };
                editIndex = null;
            } else {
                tasks.push(taskData);
            }

            updateStorage();
            renderTasks();
            clearForm();
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';

            const badgeStyles = {
                'Alta': 'bg-red-100 text-red-600 border-red-200',
                'Media': 'bg-amber-100 text-amber-600 border-amber-200',
                'Baja': 'bg-blue-100 text-blue-600 border-blue-200'
            };

            if (tasks.length === 0) {
                list.innerHTML = `<tr><td colspan="5" class="p-10 text-center text-gray-400 italic">No tienes tareas pendientes. ¬°Buen trabajo!</td></tr>`;
                return;
            }

            tasks.forEach((task, index) => {
                const badgeClass = badgeStyles[task.priority] || '';
                
                list.innerHTML += `
                    <tr class="hover:bg-slate-50 transition-all ${task.completed ? 'bg-gray-50' : ''}">
                        <td class="p-4 text-center">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTask(${index})" 
                                   class="w-5 h-5 accent-blue-600 cursor-pointer rounded">
                        </td>
                        <td class="p-4">
                            <div class="font-bold ${task.completed ? 'completed text-gray-400' : 'text-gray-700'}">
                                ${task.detail}
                            </div>
                            <span class="inline-block px-2 py-0.5 mt-1 text-[10px] font-black rounded border ${badgeClass}">
                                ${task.priority.toUpperCase()}
                            </span>
                        </td>
                        <td class="p-4 text-xs text-gray-400 hidden md:table-cell">${task.created}</td>
                        <td class="p-4 text-sm font-semibold ${task.completed ? 'text-gray-300' : 'text-gray-600'}">
                            <i class="far fa-calendar-alt mr-1 opacity-50"></i> ${task.deadline}
                        </td>
                        <td class="p-4">
                            <div class="flex justify-center gap-3">
                                <button onclick="editTask(${index})" class="text-blue-400 hover:text-blue-600 transition-all" title="Editar">
                                    <i class="fas fa-pen"></i>
                                </button>
                                <button onclick="deleteTask(${index})" class="text-red-300 hover:text-red-500 transition-all" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            updateStorage();
            renderTasks();
        }

        function deleteTask(index) {
            if(confirm("¬øEliminar esta tarea definitivamente?")) {
                tasks.splice(index, 1);
                updateStorage();
                renderTasks();
            }
        }

        function editTask(index) {
            editIndex = index;
            const t = tasks[index];
            document.getElementById('task-detail').value = t.detail;
            document.getElementById('task-deadline').value = t.deadline === 'Sin fecha' ? '' : t.deadline;
            document.getElementById('task-priority').value = t.priority;
            
            document.getElementById('btn-save').innerText = "Actualizar Tarea";
            document.getElementById('form-title').innerText = "Modificar Prioridad";
            document.getElementById('btn-cancel').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateStorage() {
            localStorage.setItem(`tasks_${currentUser}`, JSON.stringify(tasks));
        }

        function clearForm() {
            editIndex = null;
            document.getElementById('task-detail').value = '';
            document.getElementById('task-deadline').value = '';
            document.getElementById('task-priority').value = 'Media';
            document.getElementById('btn-save').innerText = "Guardar Tarea";
            document.getElementById('form-title').innerText = "Nueva Tarea";
            document.getElementById('btn-cancel').classList.add('hidden');
        }
    </script>
</body>
</html>